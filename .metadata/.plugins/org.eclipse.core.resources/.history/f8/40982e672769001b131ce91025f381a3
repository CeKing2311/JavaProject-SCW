package com.ceking.crowd.controller;

import java.util.concurrent.TimeUnit;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;

import com.ceking.crowd.api.RedisRemoteService;
import com.ceking.crowd.util.CrowdUtil;
import com.ceking.crowd.util.ResultEntity;
import com.netflix.discovery.converters.Auto;

@Controller
public class MemberController {
	
	@Autowired
	private RedisRemoteService redisRemoteService;
	
	@RequestMapping("/auth/member/send/message")
	public ResultEntity<String> sendMessage(@RequestParam("phoneNum") String phoneNum){
		
		String sign="【优益小C】";
		ResultEntity<String> resultEntity = CrowdUtil.sendCodeMessage(phoneNum, 4, sign);
		if(ResultEntity.SUCCESS.equals(resultEntity.getResult())){
			//将验证码存入redis
			String code = resultEntity.getData();
			long time =180;
			TimeUnit timeUnit = TimeUnit.MILLISECONDS;
			redisRemoteService.setRedisKeyValueRemoteWithTimeOut(phoneNum, code, time, timeUnit);
			
			
		}
		return resultEntity;
	}
}
